- content_for :head do
  = javascript_include_tag "stories/show"

.story-viewer

  .reward-stream

    %ul.reward-list

      %li#give-reward
        = form_for :reward, :url => user_rewards_path(current_user), :html => {:id => "reward-form"} do |form|
          = form.label :amount, "I would like to reward this"
          .amount-input= form.text_field :amount, :value => 1
          = form.text_area :comment, :placeholder => "Tell your followers why..."
          .impacter-and-submit
            - if @impacter
              .impacter
                = link_to(image_tag(@impacter.avatar(:thumbnail)), user_path(@impacter), :class => "avatar")
            = form.submit "Reward"
          
      - @story.rewards.each do |reward|
        %li
          .rewarder
            = link_to(image_tag(reward.user.avatar(:thumbnail)), user_path(reward.user), :class => "avatar")
            %a.name{:href => user_path(reward.user)}
              %span= reward.user.first_name
              %span= reward.user.last_name
            .amount= reward.amount
          - if reward.comment.present?
            .comment= reward.comment
          .when #{time_ago_in_words(reward.created_at)} ago
  
  .content

    #number-of-pages.hidden= @story.pages.count
  
    %ul#pages
      - pages = @story.pages
      - pages = @story.pages[0,1] if !current_user
      - pages.each do |page|
        - @page = page
        %li{:id => "page_#{page.number}", :class => page.number == 1 ? "#{page.css_class}" : "#{page.css_class} hidden"}
          = render "/stories/page_themes/#{page.partial_name}"
  
    #previous-page
      .button{:title => "Previous page"} previous page
    #next-page
      .button{:title => "Next page"} next page
  
    #metadata
      .info
        .title= @story.title
        .author by #{link_to(@story.user.name, user_path(@story.user))}
        .excerpt
          .full= @story.synopsis
      .pages
        - 1.upto @story.pages.count do |page|
          = link_to(page, "#", :class => page == 1 ? "selected" : "", :page => page)
        
- if !current_user
  - content_for :javascript do
    :javascript
      prevent_closing_of_signup_modal = true;
      $('#join-login-modal .close').hide();
      $('#join-login-modal').show();