- content_for :head do
  = javascript_include_tag "stories/form", "colorpicker"
  = stylesheet_link_tag "colorpicker"

.fullscreen-hidden
  .new-story-copy
    Mo&#149;meant stories are a new form of digital media. You simply take your creative content—whether it’s audio, video, text or images—and plug it into our customizable story blocks. The blocks allow you to layer and mash up content however you like. Hyperlinks give you an added dimension of interactivity.

    We’ve already got some great storytelling tools, but we’re always looking for feedback on how we can improve them and on what new tools you want to see. So get in touch with us!

  .finished-links
    = link_to "Preview", preview_story_path(@story), :id => "preview-link"
    = link_to "Publish", publish_story_path(@story), :id => "publish-link", :method => :post unless @story.published?
    = link_to "Delete", story_path(@story), :id => "delete-link", :method => :delete, :confirm => "Are you sure you want to delete this story?" unless @story.published?

.form.story-form
  .fullscreen-hidden
    #story-spinner Saving story...
    #story-saved Your story will be automatically saved as you edit it
  
    - if !@story.valid?
      .banner
        %span Before you can publish your story, please fix these issues:
        %ul
          - @story.errors.full_messages.each do |msg|
            %li= msg
  
  %fieldset
    %ul
      %li
        = hidden_field_tag :story_id, @story.id
        .title-input
          = label_tag :story_title, "Title"
          = text_field_tag :story_title, @story.title, :class => "monitor-story-typing", :update => "title"
          .example What's in a name? Give your story one! (ie. Around the World in 80 Days)
        .excerpt-input
          = label_tag :story_synopsis, "Synopsis"
          = text_area_tag :story_synopsis, @story.synopsis, :class => "monitor-story-typing", :update => "synopsis"
          .example Give a teaser or brief description of your story. Make sure it stands out from the crowd, and that viewers know what to expect!
          
      %li.metadata
        .price
          = label_tag :story_price, "Price"
          = text_field_tag :story_price, @story.price || "", :class => "monitor-story-typing", :update => "price"
          .example 
            Give your story a price in Momeant credits (in multiples of 10). 
            %br
            Remember: 1 MC = 1 US penny
        .tags
          = label_tag :story_tag_list, "Tags"
          = text_field_tag :story_tag_list, @story.tag_list, :class => "monitor-story-typing", :update => "tag_list"
          .example
            Choose keywords that describe your story. These help make it searchable.
            %br/
            ie. Firecracker, John Smith, X-ray

      %li.topics
        %label Categories
        .example
          Select one or more categories that describe your story.
          This makes it easier for viewers browsing the category hubs to find and buy your work!
        %ul
          - parent_topics = @topics.reject {|topic| topic.topic_id != nil}
          - parent_topics.each do |topic|
            = topic_checkbox(topic, @story, @topics)
          
      %li#page-previews
        = hidden_field_tag :story_thumbnail_page, @story.thumbnail_page ? @story.thumbnail_page : 1
        .actions
          = #link_to("Open Page Editor", "#", :id => "open-page-editor-button")
        #story-instructions
          %label Story Slides
          %p Start creating your story by clicking on one of the ten slides in the grid. This will take you to the story builder, where you can choose a layout or template for the selected slide. Then, just follow the instructions to start filling in content. Once you've completed all ten slides, be sure to select one that can be used as a thumbnail. It will represent your story wherever it appears on the site and beyond. If you need more guidance, be sure to check out our tutorial here.
        %ul
          - (1..10).each do |page_number|
            - @page = @story.pages.reject{|p|p.number != page_number}.first
            - if @page
              %li.page.has-content{:id => "preview_#{page_number}", "page-number" => page_number, :class => @story.thumbnail_page == page_number ? "chosen-thumbnail #{@page.css_class}" : @page.css_class}
                = render :partial => "stories/page_themes/#{@page.partial_name}", :locals => {:size => "medium"}
                = link_to("set thumbnail", "#", :class => @story.thumbnail_page == page_number ? "choose-thumbnail chosen" : "choose-thumbnail")
            - else
              %li.page{:id => "preview_#{page_number}", "page-number" => page_number}
                = page_number
                = link_to("set thumbnail", "#", :class => @story.thumbnail_page == page_number ? "choose-thumbnail chosen" : "choose-thumbnail")
        .clear
        
      %li#page-editor.hidden
        #page-type-chooser
          = link_to("Close Story Builder", "#", :class => "button", :id => "close-page-editor-button")
          #page-type-chooser-button
            .inner change page layout
          .info choose a slide layout
          .slider
            %ul
              %li.title.tooltipped{:title => "Title Slide", "page-type" => "title"}
              %li.full_image.tooltipped{:title => "Full Image (w/ caption)", "page-type" => "full_image"}
              %li.pullquote.tooltipped{:title => "Blockquote", "page-type" => "pullquote"}
              %li.video.tooltipped{:title => "Video", "page-type" => "video"}
              %li.split.tooltipped{:title => "Split Image/Text", "page-type" => "split"}
              %li.grid.tooltipped{:title => "Grid", "page-type" => "grid"}
        %ul#pages
          - (1..10).each do |page_number|
            - @page = @story.pages.reject{|p|p.number != page_number}.first
            - if @page
              %li.page{:id => "page_#{page_number}", "page-id" => @page.id, "page-type" => @page.partial_name}
                - @page_number = @page.number
                = render "/stories/page_forms/#{@page.partial_name}"
            - else
              %li.page{:id => "page_#{page_number}"}
          %li#page_info
            .inner
              .label Slide
              .number
                %span.current 1
                %span.of /
                %span.total 10
        #previous-page.hidden.tooltipped-n{:title => "Previous page"} previous page
        #next-page.tooltipped-n{:title => "Next page"} next page
        #loader.hidden
    
      %li.submit
        - button_text = @story.new_record? ? "Create" : "Save"
        =# form.submit "#{button_text} Story", :disable_with => "#{button_text[0..-2]}ing..."